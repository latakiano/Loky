<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalayan Cat Escape - The Cabin</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050505; font-family: sans-serif; touch-action: none; }
        #ui { position: absolute; top: 10px; width: 100%; text-align: center; color: #fff; z-index: 100; pointer-events: none; }
        .progress-bar { width: 70%; height: 12px; background: #222; margin: 10px auto; border-radius: 6px; border: 2px solid #444; overflow: hidden; }
        #fill { width: 0%; height: 100%; background: linear-gradient(90deg, #ff416c, #00ff00); transition: width 0.2s; }
        .info { font-size: 18px; color: #f1c40f; text-shadow: 2px 2px 4px #000; font-weight: bold; }
    </style>
</head>
<body>

<div id="ui">
    <div class="info">Ø£Ø³Ø±Ø¹ Ù†Ø­Ùˆ Ø§Ù„ÙƒÙˆØ®! ğŸ¡ğŸ¾</div>
    <div class="progress-bar"><div id="fill"></div></div>
    <div style="font-size: 14px;">Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <span id="dist">1500</span>m</div>
</div>

<canvas id="game"></canvas>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    const catImg = new Image();
    catImg.src = 'https://img.icons8.com/color/96/cat--v1.png'; 

    const wolfImg = new Image();
    wolfImg.src = 'https://img.icons8.com/color/150/wolf.png';

    const cabinImg = new Image();
    cabinImg.src = 'https://img.icons8.com/color/200/log-cabin.png'; // ØµÙˆØ±Ø© Ø§Ù„ÙƒÙˆØ®

    let player = { x: 150, y: canvas.height/2, w: 50, h: 50, v: 0, g: 0.45, j: -8 };
    let monster = { x: -150, y: canvas.height/2, w: 110, h: 110 };
    let obstacles = [], distance = 1500, active = true, win = false, gameStarted = false;
    let cabinX = -500; // Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙƒÙˆØ® ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
    
    // Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨
    const colors = ["#FFFF00", "#0000FF", "#FF0000", "#000000", "#FFA500", "#800000", "#8B4513", "#FFFFFF"];
    let colorIndex = 0;

    function createObstacle() {
        if (distance < 200) return; // ØªÙˆÙ‚Ù Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø¹Ù†Ø¯ Ø§Ù‚ØªØ±Ø§Ø¨ Ø§Ù„ÙƒÙˆØ®
        let gap = 250; 
        let top = Math.random() * (canvas.height - gap - 160) + 80;
        obstacles.push({ x: canvas.width, t: top, g: gap, color: colors[colorIndex % colors.length] });
        colorIndex++;
    }

    function update() {
        if (!active || win || !gameStarted) return;

        player.v += player.g;
        player.y += player.v;
        distance -= 2;

        // Ø°ÙƒØ§Ø¡ Ø§Ù„Ø°Ø¦Ø¨: Ø§Ù„Ø¢Ù† Ù‡Ùˆ Ø£Ø¨Ø·Ø£ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ÙŠØ¹Ø·ÙŠÙƒ ÙØ±ØµØ©
        monster.y += (player.y - 30 - monster.y) * 0.04;
        let limitX = player.x - 140; 
        if (monster.x < limitX) monster.x += 0.2; 
        else monster.x -= 0.5;

        document.getElementById('dist').innerText = Math.max(0, Math.floor(distance));
        document.getElementById('fill').style.width = (1 - distance/1500)*100 + "%";

        // Ø¸Ù‡ÙˆØ± Ø§Ù„ÙƒÙˆØ® ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
        if (distance <= 0) {
            if (cabinX === -500) cabinX = canvas.width;
            cabinX -= 5;
            if (player.x > cabinX + 50) win = true; // Ø§Ù„ÙÙˆØ² Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙƒÙˆØ®
        }

        if (distance > 100 && (obstacles.length === 0 || obstacles[obstacles.length-1].x < canvas.width - 380)) {
            createObstacle();
        }

        for (let i = obstacles.length - 1; i >= 0; i--) {
            let p = obstacles[i];
            p.x -= 5;
            if (player.x < p.x + 60 && player.x + player.w > p.x && (player.y < p.t || player.y + player.h > p.t + p.g)) active = false;
            if (p.x + 60 < 0) obstacles.splice(i, 1);
        }

        if (player.y > canvas.height || player.y < 0 || player.x <= monster.x + 60) active = false;
    }

    function draw() {
        ctx.fillStyle = "#0a0a0a";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Ø±Ø³Ù… Ø§Ù„ÙƒÙˆØ®
        if (cabinX > -500) {
            ctx.drawImage(cabinImg, cabinX, canvas.height/2 - 100, 200, 200);
        }

        // Ø±Ø³Ù… Ø§Ù„Ø°Ø¦Ø¨
        if (gameStarted) {
            ctx.drawImage(wolfImg, monster.x, monster.y, monster.w, monster.h);
        }

        // Ø±Ø³Ù… Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø¨Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        obstacles.forEach(p => {
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, 0, 60, p.t);
            ctx.fillRect(p.x, p.t + p.g, 60, canvas.height);
            ctx.strokeStyle = "gray"; ctx.strokeRect(p.x, 0, 60, p.t); ctx.strokeRect(p.x, p.t + p.g, 60, canvas.height);
        });

        // Ø±Ø³Ù… Ø§Ù„Ù‚Ø·Ø©
        ctx.drawImage(catImg, player.x, player.y, player.w, player.h);

        if (win) {
            ctx.fillStyle = "rgba(0,0,0,0.8)"; ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = "#2ecc71"; ctx.font = "bold 30px Arial"; ctx.textAlign="center";
            ctx.fillText("ğŸ¡ Ø¯Ø®Ù„Øª Ø§Ù„ÙƒÙˆØ® Ø¨Ø³Ù„Ø§Ù…! Ù…Ø¨Ø±ÙˆÙƒ ğŸ†", canvas.width/2, canvas.height/2);
        } else if (!active) {
            ctx.fillStyle = "rgba(0,0,0,0.85)"; ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = "#ff4444"; ctx.font = "bold 25px Arial"; ctx.textAlign="center";
            ctx.fillText("Ø£Ù…Ø³Ùƒ Ø¨Ùƒ Ø§Ù„Ø°Ø¦Ø¨! ğŸº", canvas.width/2, canvas.height/2);
        }

        update();
        requestAnimationFrame(draw);
    }

    function reset() {
        player.y = canvas.height/2; player.v = 0; monster.x = -150; 
        obstacles = []; distance = 1500; active = true; win = false; 
        gameStarted = false; cabinX = -500; colorIndex = 0;
    }

    const action = (e) => {
        if (e.type === 'touchstart') e.preventDefault();
        if (!active || win) reset(); else { gameStarted = true; player.v = player.j; }
    };
    window.addEventListener('mousedown', action);
    window.addEventListener('touchstart', action, {passive: false});
    draw();
</script>
</body>
</html>