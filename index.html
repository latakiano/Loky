<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalayan Cat Adventure - Pro</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; touch-action: none; }
        #ui { position: absolute; top: 10px; width: 100%; text-align: center; color: #fff; z-index: 100; pointer-events: none; }
        .progress-bar { width: 70%; height: 12px; background: #222; margin: 10px auto; border-radius: 6px; border: 2px solid #444; overflow: hidden; }
        #fill { width: 0%; height: 100%; background: linear-gradient(90deg, #ff416c, #00ff00); transition: width 0.2s; }
        .info { font-size: 18px; color: #f1c40f; text-shadow: 2px 2px 4px #000; font-weight: bold; }
    </style>
</head>
<body>

<div id="ui">
    <div class="info">Ø£Ø³Ø±Ø¹! Ø§Ù„Ø°Ø¦Ø¨ ÙŠÙ‚ØªØ±Ø¨ ğŸºğŸ¾</div>
    <div class="progress-bar"><div id="fill"></div></div>
    <div style="font-size: 14px;">Ø§Ù„Ù…Ø³Ø§ÙØ©: <span id="dist">1500</span>m | Ø§Ù„Ø³Ø±Ø¹Ø©: <span id="speed">1x</span></div>
</div>

<canvas id="game"></canvas>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    const catImg = new Image();
    catImg.src = 'https://img.icons8.com/color/96/cat--v1.png'; 

    const wolfImg = new Image();
    wolfImg.src = 'https://img.icons8.com/color/150/wolf.png';

    let player = { x: 120, y: canvas.height/2, w: 50, h: 50, v: 0, g: 0.45, j: -8 };
    let monster = { x: -200, y: canvas.height/2, w: 110, h: 110, targetY: canvas.height/2 };
    let obstacles = [], distance = 1500, active = true, win = false, gameStarted = false;
    let baseSpeed = 5;
    let currentSpeed = 5;
    let obstacleCount = 0;

    function createObstacle() {
        if (1500 - distance < 200) return; 
        let gap = 240 - (Math.min(50, (1500 - distance) / 30)); // Ø§Ù„ÙØªØ­Ø© ØªØ¶ÙŠÙ‚ ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹
        let top = Math.random() * (canvas.height - gap - 150) + 70;
        obstacles.push({ x: canvas.width, t: top, g: gap, color: "#2ecc71" });
    }

    function update() {
        if (!active || win || !gameStarted) return;

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø±Ø¹Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©
        currentSpeed = baseSpeed + (1500 - distance) / 300;
        document.getElementById('speed').innerText = (currentSpeed/5).toFixed(1) + "x";

        player.v += player.g;
        player.y += player.v;
        distance -= (currentSpeed / 4);
        
        // Ø°ÙƒØ§Ø¡ Ø§Ù„Ø°Ø¦Ø¨: ÙŠØªØ¨Ø¹ Ø§Ù„Ù‚Ø·Ø© Ø¨Ø³Ù„Ø§Ø³Ø© ÙˆÙ„ÙŠØ³ Ø¨Ø§Ù„Ù‚ÙØ²
        monster.targetY = player.y - 30;
        monster.y += (monster.targetY - monster.y) * 0.05; // Ø­Ø±ÙƒØ© Ù†Ø§Ø¹Ù…Ø©
        
        // Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø°Ø¦Ø¨: ÙŠØªÙ‚Ø¯Ù… Ø¥Ø°Ø§ Ø£Ø®Ø·Ø£Øª ÙˆÙŠØªØ±Ø§Ø¬Ø¹ Ø¥Ø°Ø§ ÙƒÙ†Øª Ø³Ø±ÙŠØ¹Ø§Ù‹
        let idealMonsterX = player.x - 120;
        monster.x += (idealMonsterX - monster.x) * 0.01;

        document.getElementById('dist').innerText = Math.max(0, Math.floor(distance));
        document.getElementById('fill').style.width = (1 - distance/1500)*100 + "%";

        if (distance <= 0) win = true;

        if (obstacles.length === 0 || obstacles[obstacles.length-1].x < canvas.width - 350) {
            createObstacle();
        }

        for (let i = obstacles.length - 1; i >= 0; i--) {
            let p = obstacles[i];
            p.x -= currentSpeed;
            
            // ØªØµØ§Ø¯Ù… Ø¯Ù‚ÙŠÙ‚ Ø¬Ø¯Ø§Ù‹
            if (player.x + 15 < p.x + 60 && player.x + player.w - 15 > p.x && 
               (player.y + 15 < p.t || player.y + player.h - 15 > p.t + p.g)) {
                active = false;
            }
            if (p.x + 60 < 0) obstacles.splice(i, 1);
        }

        // Ø§Ù„Ø³Ù‚ÙˆØ· Ø£Ùˆ Ù„Ù…Ø³ Ø§Ù„Ø°Ø¦Ø¨
        if (player.y > canvas.height || player.y < -50 || (monster.x + 70 > player.x)) active = false;
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Ø®Ù„ÙÙŠØ© Ø¨Ø³ÙŠØ·Ø© Ù…ØªØ­Ø±ÙƒØ©
        ctx.fillStyle = "#0a0a0a";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Ø±Ø³Ù… Ø§Ù„Ø°Ø¦Ø¨
        if (gameStarted) {
            ctx.drawImage(wolfImg, monster.x, monster.y, monster.w, monster.h);
        }

        // Ø±Ø³Ù… Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
        obstacles.forEach(p => {
            ctx.fillStyle = "#2ecc71";
            ctx.fillRect(p.x, 0, 60, p.t);
            ctx.fillRect(p.x, p.t + p.g, 60, canvas.height);
        });

        // Ø±Ø³Ù… Ø§Ù„Ù‚Ø·Ø© Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ù…ÙŠÙ„Ø§Ù† Ø¨Ø³ÙŠØ· Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø±ÙƒØ©
        ctx.save();
        ctx.translate(player.x + player.w/2, player.y + player.h/2);
        ctx.rotate(player.v * 0.04);
        ctx.drawImage(catImg, -player.w/2, -player.h/2, player.w, player.h);
        ctx.restore();

        if (win) {
            showOverlay("ğŸ¡ ÙˆØµÙ„Ù†Ø§ Ø¨Ø³Ù„Ø§Ù…! ğŸ†", "#2ecc71");
        } else if (!active) {
            showOverlay("Ø£ÙƒÙ„Ùƒ Ø§Ù„Ø°Ø¦Ø¨! ğŸº ØªØ¹Ø§Ø²ÙŠÙ†Ø§", "#ff4444");
        } else if (!gameStarted) {
            ctx.fillStyle = "white"; ctx.textAlign="center"; ctx.font = "20px Arial";
            ctx.fillText("Ø§Ù„Ù…Ø³ Ù„ØªØ¨Ø¯Ø£ Ø§Ù„Ù‡Ø±ÙˆØ¨ Ø§Ù„ÙƒØ¨ÙŠØ± ğŸ¾", canvas.width/2, canvas.height/2);
        }

        update();
        requestAnimationFrame(draw);
    }

    function showOverlay(msg, color) {
        ctx.fillStyle = "rgba(0,0,0,0.8)"; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = color; ctx.font = "bold 28px Arial"; ctx.textAlign="center";
        ctx.fillText(msg, canvas.width/2, canvas.height/2);
        ctx.fillStyle = "white"; ctx.font = "16px Arial";
        ctx.fillText("Ø§Ù„Ù…Ø³ Ù„Ù„Ø¥Ø¹Ø§Ø¯Ø©", canvas.width/2, canvas.height/2 + 50);
    }

    function reset() {
        player.y = canvas.height/2; player.v = 0; monster.x = -200; 
        obstacles = []; distance = 1500; active = true; win = false; 
        gameStarted = false; currentSpeed = baseSpeed;
    }

    const action = (e) => {
        if (e.type === 'touchstart') e.preventDefault();
        if (!active || win) reset(); 
        else { 
            gameStarted = true; 
            player.v = player.j; 
        }
    };
    
    window.addEventListener('mousedown', action);
    window.addEventListener('touchstart', action, {passive: false});

    draw();
</script>
</body>
</html>